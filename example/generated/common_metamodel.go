// Code generated by metamodel. DO NOT EDIT.

package metamodel_

import (
	"fmt"
	"strings"
)

const (
	Comma string = ", "
)

// Columns joins the given column expressions with a comma separator.
// Use it to build SELECT lists:
//
//	db.Select(Columns(
//	    GormTest_.FeatureName.String(),
//	    CategoryEntity_.Value.As("category_id"),
//	)).Where(...).GroupBy(...).Having(...).Order(...)
//
// Example full query:
//
//	db.Select(Columns(
//	    GormTest_.FeatureName.String(),
//	    "COUNT(*) as total",
//	)).Where(GormTest_.Status.Equal("active")).
//	  GroupBy(GormTest_.FeatureName.String()).
//	  Having(clause.Gt{Column: "COUNT(*)", Value: 5}).
//	  Order(GormTest_.CreatedAt.Desc()).
//	  Find(&results)
func Columns(cols ...string) string {
	return strings.Join(cols, ", ")
}

func Join(joinTable string, conditions ...string) string {
	return fmt.Sprintf(" JOIN %s ON %s ", joinTable, strings.Join(conditions, " AND "))
}

// QueryBuilder helps construct complete SQL SELECT statements.
type QueryBuilder struct {
	selectCols  []string
	fromTable   string
	whereConds  []string
	groupByCols []string
	havingConds []string
	orderByCols []string
}

// NewQueryBuilder creates a new QueryBuilder for the given table.
func NewQueryBuilder(tableName string) *QueryBuilder {
	return &QueryBuilder{
		fromTable: tableName,
	}
}

// Select adds columns to the SELECT clause.
func (qb *QueryBuilder) Select(cols ...string) *QueryBuilder {
	qb.selectCols = append(qb.selectCols, cols...)
	return qb
}

// Where adds conditions to the WHERE clause.
func (qb *QueryBuilder) Where(conditions ...string) *QueryBuilder {
	qb.whereConds = append(qb.whereConds, conditions...)
	return qb
}

// GroupBy adds columns to the GROUP BY clause.
func (qb *QueryBuilder) GroupBy(cols ...string) *QueryBuilder {
	qb.groupByCols = append(qb.groupByCols, cols...)
	return qb
}

// Having adds conditions to the HAVING clause.
func (qb *QueryBuilder) Having(conditions ...string) *QueryBuilder {
	qb.havingConds = append(qb.havingConds, conditions...)
	return qb
}

// OrderBy adds columns to the ORDER BY clause.
func (qb *QueryBuilder) OrderBy(cols ...string) *QueryBuilder {
	qb.orderByCols = append(qb.orderByCols, cols...)
	return qb
}

// Build constructs and returns the complete SQL SELECT statement as a string.
// Expected format: "SELECT a,b,c FROM table WHERE ... GROUP BY ... HAVING ... ORDER BY ..."
func (qb *QueryBuilder) Build() string {
	var query strings.Builder

	// SELECT clause
	query.WriteString("SELECT ")
	if len(qb.selectCols) > 0 {
		query.WriteString(strings.Join(qb.selectCols, ","))
	} else {
		query.WriteString("*")
	}

	// FROM clause
	query.WriteString(" FROM ")
	query.WriteString(qb.fromTable)

	// WHERE clause
	if len(qb.whereConds) > 0 {
		query.WriteString(" WHERE ")
		query.WriteString(strings.Join(qb.whereConds, " AND "))
	}

	// GROUP BY clause
	if len(qb.groupByCols) > 0 {
		query.WriteString(" GROUP BY ")
		query.WriteString(strings.Join(qb.groupByCols, ","))
	}

	// HAVING clause
	if len(qb.havingConds) > 0 {
		query.WriteString(" HAVING ")
		query.WriteString(strings.Join(qb.havingConds, " AND "))
	}

	// ORDER BY clause
	if len(qb.orderByCols) > 0 {
		query.WriteString(" ORDER BY ")
		query.WriteString(strings.Join(qb.orderByCols, ","))
	}

	return query.String()
}
